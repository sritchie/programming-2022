<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Building SICMUtils, the Atelier of Abstractions</title>
    <meta name="author" content="Sam Ritchie" />
    <style type="text/css">
      .underline {
        text-decoration: underline;
      }
    </style>
    <link rel="stylesheet" href="../reveal.js/dist/reveal.css" />

    <link
      rel="stylesheet"
      href="../reveal.js/dist/theme/solarized.css"
      id="theme"
    />
    <link rel="stylesheet" href="../reveal.js/plugin/highlight/zenburn.css" />
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <section id="slide-org856ba9e">
            <h2 id="org856ba9e">Building SICMUtils</h2>
            <p>The Atelier of Abstractions</p>
          </section>
        </section>
        <section>
          <section id="slide-orga63e0d7">
            <h2 id="orga63e0d7">SICMUtils</h2>
            <aside class="notes">
              <ul>
                <li>CAS, previewed yesterday</li>
                <li>Computer algebra system, previewed during the keynote</li>
              </ul>
            </aside>
          </section>
          <section id="slide-org70980f0">
            <h3 id="org70980f0">❤️ Open Source ❤️</h3>
            <aside class="notes">
              <ul>
                <li>meant to be ripped off in pieces!</li>
              </ul>
            </aside>

            <p>
              <a href="https://github.com/sicmutils/sicmutils"
                >https://github.com/sicmutils/sicmutils</a
              >
            </p>
            <img width="100%" src="../images/sicmutils.png" />
          </section>
        </section>
        <section>
          <section id="slide-org1be7c7f">
            <h2 id="org1be7c7f">Thanks to GJS</h2>
            <aside class="notes">
              <ul>
                <li>uses many techniques from SDF</li>
              </ul>
            </aside>

            <p>(and many others!)</p>

            <img height="500" src="../images/gjs.jpg" />
            <img height="500" src="../images/sdf.jpeg" />
          </section>
        </section>
        <section>
          <section id="slide-org30ec2d7">
            <h2 id="org30ec2d7">Agenda</h2>
            <aside class="notes">nil</aside>

            <ul>
              <li>Overview of SICMUtils</li>
              <li>Programming Techniques</li>
              <li>Issues!</li>
              <li>Revealing Demos</li>
            </ul>
          </section>
        </section>
        <section>
          <section id="slide-org2d92fb6">
            <h2 id="org2d92fb6">SICMUtils Project goals</h2>
            <aside class="notes">
              <p>reiterate:</p>

              <ul>
                <li>trying to write this sweeping history of modern physics</li>
                <li>convinced you need to write AND read in the env</li>
                <li>so: kitchen sink, embeddable in diff envs</li>
              </ul>
            </aside>
          </section>
          <section id="slide-orgd9fe494">
            <h3 id="orgd9fe494">Library as Workshop / Textbook</h3>
            <aside class="notes">
              <ul>
                <li>library is its own target</li>
                <li>filled with stories</li>
              </ul>
            </aside>

            <div id="org284e423" class="figure">
              <p><img src="../images/workshop.jpeg" alt="workshop.jpeg" /></p>
            </div>
          </section>
          <section id="slide-org6b57035">
            <h3 id="org6b57035">Many Environments</h3>
            <aside class="notes">
              <ul>
                <li>not an environment, it's a library of components</li>
                <li>lives in many places</li>
              </ul>
            </aside>

            <ul>
              <li>REPL</li>
              <li>Nextjournal</li>
              <li><code>org-mode</code>, these slides</li>
              <li>Clojure, Clojurescript</li>
              <li>Zeugma, any Java environment</li>
              <li>
                <a href="https://www.texmacs.org/tmweb/home/welcome.en.html"
                  >TexMacs</a
                >
              </li>
              <li>Roam Research or Obsidian, etc</li>
            </ul>
          </section>
        </section>
        <section>
          <section id="slide-org787b9ae">
            <h2 id="org787b9ae">What's in the library?</h2>
            <aside class="notes">
              <ul>
                <li>much familiar for lispers</li>
                <li>27kLOC src, 25kLOC tests</li>
              </ul>
            </aside>
          </section>
          <section data-background="../images/sicmutils_ns.png"></section>
          <section data-background="../images/quad_island.png"></section>
          <section id="slide-org36ec7ac">
            <h3 id="org36ec7ac">Numerics</h3>
            <aside class="notes">
              <ul>
                <li>no ratio, complex in JS</li>
                <li>prep the host</li>
              </ul>
            </aside>

            <ul>
              <li>
                full numeric tower in JavaScript, up to <code>Complex</code>
              </li>
              <li>dual numbers</li>
              <li>modular arithmetic types</li>
              <li>Quaternions, beyond</li>
            </ul>
          </section>
          <section id="slide-orgef68b14">
            <h3 id="orgef68b14">Extensible Generics</h3>
            <aside class="notes">
              <ul>
                <li>
                  generic, extensible functions via protocols, multimethods
                </li>
                <li>`type` vs `kind`</li>
                <li>show library code</li>
                <li>extended to functions!</li>
              </ul>
            </aside>

            <div class="org-src-container">
              <pre><code class="clojure" >((square +) 'x 'y)
</code></pre>
            </div>

            <pre class="example">
(expt (+ x y) 2)

</pre
            >

            <div class="org-src-container">
              <pre><code class="clojure" >((square +) 1 2)
</code></pre>
            </div>

            <pre class="example">
9

</pre
            >
          </section>
          <section id="slide-org6d962dc">
            <h3 id="org6d962dc">Examples of Generics</h3>
            <aside class="notes">
              <ul>
                <li>sample of the extensible methods&#x2026;</li>
                <li>you can make your own of course</li>
              </ul>
            </aside>

            <div class="org-src-container">
              <pre><code class="clojure" > [sicmutils.generic
  * + - / divide
  negate
  negative? infinite?
  invert
  abs
  sqrt
  quotient remainder modulo
  floor ceiling
  integer-part fractional-part
  expt
  exp exp2 exp10
  log log2 log10
  gcd lcm
  exact-divide
  square cube
  cos sin tan
  cot sec csc
  atan
  acos asin acot asec acsc
  cosh sinh tanh coth sech csch
  acosh asinh atanh acoth asech acsch
  sinc tanc sinhc tanhc
  make-rectangular make-polar
  real-part imag-part
  magnitude angle conjugate
  transpose trace determinant dimension
  dot-product inner-product outer-product cross-product
  partial-derivative Lie-derivative
  solve-linear solve-linear-left solve-linear-right
  simplify]
</code></pre>
            </div>
          </section>
          <section id="slide-orgbb605dc">
            <h3 id="orgbb605dc">Symbolic Computation</h3>
            <aside class="notes">
              <ul>
                <li>simplifier, rules</li>
              </ul>
            </aside>

            <div class="org-src-container">
              <pre><code class="clojure" >(+ (square (sin 'x))
   (square (cos 'x)))
</code></pre>
            </div>

            <pre class="example">
(+ (expt (sin x) 2) (expt (cos x) 2))

</pre
            >

            <div class="org-src-container">
              <pre><code class="clojure" >(simplify
 (+ (square (sin 'x))
    (square (cos 'x))))
</code></pre>
            </div>

            <pre class="example">
1

</pre
            >
          </section>
          <section id="slide-org09c4912">
            <h3 id="org09c4912">"Compound" Data Types</h3>
            <aside class="notes">
              <ul>
                <li>show off</li>
              </ul>
            </aside>

            <ul>
              <li>vector, matrix, up, down structures</li>
              <li>polynomial, rational function</li>
              <li>power series</li>
              <li>quaternions</li>
            </ul>
          </section>
          <section id="slide-org70d5edb">
            <h3 id="org70d5edb">"Literals", ie, symbolic-like things:</h3>
            <ul>
              <li>literal numbers</li>
              <li>literal functions</li>
              <li>symbols, or <code>literal-number</code></li>
              <li>literal vectors, matrices etc</li>
            </ul>
          </section>
          <section id="slide-org2a7d720">
            <h3 id="org2a7d720">Pattern Matching DSL</h3>
            <aside class="notes">
              <p>implemented in SDF, extended to Clojure</p>
            </aside>

            <div class="org-src-container">
              <pre><code class="clojure" >(rule (/ (* ??u ?x ??v) (sqrt ?x))
      =&gt;
      (* ??u (sqrt ?x) ??v))
</code></pre>
            </div>
          </section>
          <section id="slide-org316e60f">
            <h3 id="org316e60f">Pattern Combinators</h3>
            <div class="org-src-container">
              <pre><code class="clojure" >(let [r (while (fn [l _] (&lt; l 100))
          (rule ?x =&gt; (? #(inc (% '?x)))))]
  (= 101 (r 12)))
</code></pre>
            </div>

            <p data-fragment-index="2" class="fragment roll-in">
              Literal Derivative:
            </p>

            <div class="org-src-container">
              <pre
                data-fragment-index="2"
                class="fragment roll-in"
              ><code class="clojure" >(choice
 (rule (D ?f)           =&gt; ((expt D 2) ?f))
 (rule ((expt D ?n) ?f) =&gt; ((expt D (? #(inc (% '?n)))) ?f))
 (rule ?f               =&gt; (D ?f)))
</code></pre>
            </div>
          </section>
          <section id="slide-orged95e25">
            <h3 id="orged95e25">Renderers</h3>
            <aside class="notes">
              <ul>
                <li>obvious, open thing, S-expressions</li>
                <li>simplifier</li>
              </ul>
            </aside>

            <p>Infix:</p>

            <div class="org-src-container">
              <pre><code class="clojure" >(-&gt;infix
 (+ (square (sin 'eta))
    (cube (tan 'phi_2))))
</code></pre>
            </div>

            <pre class="example">
sin²(η) + (tan(φ₂))³
</pre
            >

            <p>TeX:</p>

            <div class="org-src-container">
              <pre><code class="clojure" >(-&gt;TeX
 (+ (square (sin 'eta))
    (cube (tan 'phi_2))))
</code></pre>
            </div>

            <pre class="example">
{\sin}^{2}\left(\eta\right) + {\left(\tan\left({\phi}_2\right)\right)}^{3}
</pre
            >
          </section>
          <section id="slide-org0c7a55d">
            <h3 id="org0c7a55d">Renderers</h3>
            <p>JavaScript Source Renderer</p>

            <div class="org-src-container">
              <pre><code class="clojure" >(println
 (-&gt;JavaScript
  (+ (square (sin 'eta))
     (cube (tan 'phi-2)))))
</code></pre>
            </div>

            <pre class="example">
function(eta, phi_2) {
  return Math.pow(Math.sin(eta), 2) + Math.pow(Math.tan(phi_2), 3);
}
</pre
            >
          </section>
          <section id="slide-org4026486">
            <h3 id="org4026486">Function Compilation</h3>
            <aside class="notes">
              <ul>
                <li>reuses all the stuff above</li>
                <li>you can do this for matrices too!</li>
              </ul>
            </aside>

            <div class="org-src-container">
              <pre><code class="clojure" >(defn my-fn [x y]
  (+ x
     (sin y)
     (square (cos 'x))
     (square (sin 'x))
     (cube (sin y))))

(binding [*mode* :source]
  (compile-fn my-fn))
</code></pre>
            </div>

            <pre class="example">
(clojure.core/fn [x45929 x45930]
  (clojure.core/let [G0000000000000000 (Math/sin x45930)]
    (clojure.core/+ (clojure.core/*
                     -1.0
                     G0000000000000000
                     (Math/pow (Math/cos x45930) 2.0))
                    x45929
                    (clojure.core/* 2.0 G0000000000000000)
                   1.0)))
</pre
            >
          </section>
          <section id="slide-org72ef548">
            <h3 id="org72ef548">Functional Numerical Methods</h3>
            <ul>
              <li>Univariate and multivariate minimization</li>
              <li>Polynomial and RF interpolation</li>
              <li>Richardson Extrapolation</li>
              <li>(FUNCTIONAL!) Numerical quadrature</li>
              <li>numeric derivatives</li>
              <li>Native ODE solvers</li>
              <li>&#x2026;</li>
            </ul>
          </section>
          <section id="slide-org7eb3b27">
            <h3 id="org7eb3b27">Automatic Differentiation</h3>
            <ul>
              <li>Forward mode,</li>
              <li>immutable reverse mode!</li>
            </ul>
          </section>
          <section id="slide-orgd2fa04e">
            <h3 id="orgd2fa04e">Physics</h3>
            <ul>
              <li>Hamiltonian and Lagrangian mechanics</li>
              <li>Differential Geometry</li>
              <li>Manifolds, Coordinate Systems</li>
              <li>Tensor Calculus</li>
              <li>Geometric Algebra</li>
            </ul>
          </section>
          <section id="slide-orga97fa0a">
            <h3 id="orga97fa0a">Animations</h3>
            <ul>
              <li>Mathbox</li>
              <li>JSXGraph</li>
            </ul>
          </section>
        </section>
        <section>
          <section id="slide-org11668db">
            <h2 id="org11668db">SICMUtils Programming Techniques</h2>
            <aside class="notes">
              <ul>
                <li>gotten easier as we go!</li>
                <li>how?</li>
              </ul>
            </aside>

            <ul>
              <li>Extensible Generics Stick with Clojure</li>
              <li>Combinators</li>
              <li>DSLs, Pattern Matching</li>
            </ul>
          </section>
          <section id="slide-org1105c55">
            <h3 id="org1105c55">Type vs Kind</h3>
            <aside class="notes">
              <ul>
                <li>protocol vs multimethod dispatch</li>
                <li>protocols are fast, multimethods are flexible</li>
              </ul>
            </aside>

            <div class="org-src-container">
              <pre><code class="clojure" >(map kind [(make-rectangular 1 2) 10 {:k "v"}])
</code></pre>
            </div>

            <pre class="example">
(:sicmutils.complex/complex
 java.lang.Long
 clojure.lang.PersistentArrayMap)

</pre
            >
          </section>
          <section id="slide-org90a8422">
            <h3 id="org90a8422">Constrained Extensibility</h3>
            <aside class="notes">
              <ul>
                <li>On a per type basis</li>
                <li>but folks can install their own generics too!</li>
              </ul>
            </aside>

            <div class="org-src-container">
              <pre><code class="clojure" >(derive ::square-matrix ::matrix)
(derive ::column-matrix ::matrix)
(derive ::row-matrix ::matrix)
(derive ::matrix ::f/cofunction)

(defmethod g/mul [::matrix ::matrix] [a b]
  (mul a b))

(defmethod g/mul [::v/scalar ::matrix] [n a]
  (scalar*matrix n a))

(defmethod g/mul [::matrix ::v/scalar] [a n]
  (matrix*scalar a n))
</code></pre>
            </div>
          </section>
          <section id="slide-org4eed760">
            <h3 id="org4eed760">Stick with Clojure</h3>
            <aside class="notes">nil</aside>

            <ul>
              <li>Different Environments, CLJS</li>
              <li>Small # of core data structures</li>
              <li>immutability everywhere</li>
            </ul>
          </section>
          <section id="slide-orgbc2e6b4">
            <h3 id="orgbc2e6b4">Pragmatic Core</h3>
            <div class="org-src-container">
              <pre><code class="clojure" >[] {} #{} () :keyword 'sym

#quaternion [1 2 3 4]

#complex [2 3]
</code></pre>
            </div>
          </section>
          <section id="slide-org27e9da3">
            <h3 id="org27e9da3">Combinators</h3>
            <ul>
              <li>pattern matching</li>
              <li>many of the arithmetic types have this built in</li>
              <li>
                numerical methods work too, we had the
                <code>infinite</code> combinator.
              </li>
            </ul>
          </section>
          <section id="slide-org4d721c8">
            <h3 id="org4d721c8">DSL, Pattern Matching:</h3>
            <div class="org-src-container">
              <pre><code class="clojure" data-line-numbers="3-6|8-12|14-17|19-24">(require '[pattern.rule :as r :refer [ruleset =&gt;]])

(defn unary-elimination [&amp; ops]
  (let [op-set (into #{} ops)]
    (ruleset
     ((? _ op-set) ?x) =&gt; ?x)))

(defn constant-elimination [op constant]
  (letfn [(filter-constants [{xs '??xs}]
            (remove #{constant} xs))]
    (ruleset
     (~op ??xs) =&gt; (~op (?? ~filter-constants)))))

(defn constant-promotion [op constant]
  (ruleset
   (~op _ ~constant) =&gt; ~constant
   (~op ~constant _) =&gt; ~constant))

(def my-simplify
  (r/rule-simplifier
   (unary-elimination '+ '*)
   (constant-elimination '+ 0)
   (constant-elimination '* 1)
   (constant-promotion '* 0)))
</code></pre>
            </div>
          </section>
          <section>
            <div class="org-src-container">
              <pre><code class="clojure" >(my-simplify
 '(cos (+ 0 (+ 0 12 0) (* 1 x))))
</code></pre>
            </div>

            <pre class="example">
(cos (+ 12 x))

</pre
            >
          </section>
          <section id="slide-orgb8e7edf">
            <h3 id="orgb8e7edf">Operator Example from the codebase</h3>
            <div class="org-src-container">
              <pre><code class="clojure" >(def simplify-operator-name
  (rule-simplifier
   (rules/associative '+ '*)
   rules/exponent-contract
   (rules/unary-elimination '+ '*)))
</code></pre>
            </div>
          </section>
          <section id="slide-orgf98eef0">
            <h3 id="orgf98eef0">Generic Programming</h3>
            <ul>
              <li class="off">
                <code>[&#xa0;]</code> bring compilation example back up
              </li>
            </ul>
          </section>
          <section id="slide-orgc42dc05">
            <h3 id="orgc42dc05">Multi-Stage Programming</h3>
            <aside class="notes">
              <ul>
                <li>
                  <p>
                    just as easily you could be sending operations off to matrix
                    library&#x2026; there is no reason to prefer Python etc.
                  </p>

                  <p>Everything fast there is staged down to FORTRAN etc.</p>
                </li>
              </ul>
            </aside>
          </section>
          <section id="slide-org3cf25c3">
            <h3 id="org3cf25c3">Community!</h3>
            <p>It has gotten EASIER to add to it as it's gone.</p>

            <ul>
              <li>Nextjournal, Clerk, Jack Rusher, Martin Kavalar etc</li>
              <li>Maria</li>
              <li>SCI</li>
              <li>clj-kondo</li>
            </ul>
          </section>
        </section>
        <section>
          <section id="slide-org3c2ef19">
            <h2 id="org3c2ef19">Hard?</h2>
            <ul>
              <li>No types so far</li>
              <li>what's the right way to introspect the library?</li>
              <li>viewers are difficult</li>
              <li>how to make the lib disppear?</li>
            </ul>
          </section>
        </section>
        <section>
          <section id="slide-orgaf603cc">
            <h2 id="orgaf603cc">What's Coming?</h2>
            <div class="outline-text-2" id="text-orgaf603cc"></div>
          </section>
          <section id="slide-orgc0d356a">
            <h3 id="orgc0d356a">Rewrite the textbooks</h3>
            <img height="500" src="../images/sicm.jpeg" />
            <img height="500" src="../images/fdg.jpeg" />
          </section>
          <section id="slide-org0cb6269">
            <h3 id="org0cb6269">=&gt; Wikipedia</h3>
          </section>
        </section>
        <section>
          <section id="slide-org60dddfb">
            <h2 id="org60dddfb">Thanks!</h2>
            <aside class="notes">
              <p>questions?</p>
            </aside>

            <p>Sam Ritchie, Mentat Collective</p>

            <p>
              <a href="https://twitter.com/sritchie">@sritchie</a>
            </p>

            <p>
              Slides, Demos live at
              <a href="https://github.com/sritchie/programming-2022"
                >https://github.com/sritchie/programming-2022</a
              >
            </p>
          </section>
        </section>
      </div>
    </div>
    <script src="../reveal.js/dist/reveal.js"></script>
    <script src="../reveal.js/plugin/notes/notes.js"></script>
    <script src="../reveal.js/plugin/highlight/highlight.js"></script>
    <script src="../reveal.js/plugin/search/search.js"></script>
    <script src="../reveal.js/plugin/zoom/zoom.js"></script>
    <script>
      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        slideNumber: "c",
        rollingLinks: false,
        keyboard: true,
        mouseWheel: false,
        fragmentInURL: false,
        hashOneBasedIndex: false,
        pdfSeparateFragments: true,
        overview: true,

        transition: "none",
        transitionSpeed: "default",

        // Plugins with reveal.js 4.x
        plugins: [RevealNotes, RevealHighlight, RevealSearch, RevealZoom],

        // Optional libraries used to extend reveal.js
        dependencies: [],
      });
    </script>
  </body>
</html>
